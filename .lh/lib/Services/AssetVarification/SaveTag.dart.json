{
    "sourceFile": "lib/Services/AssetVarification/SaveTag.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1752153457608,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1752153457608,
            "name": "Commit-0",
            "content": "import 'dart:io';\n\nimport 'package:fats_client/Services/AssetVarification/DeleteTag.dart';\nimport 'package:fats_client/screens/home_screen.dart';\nimport 'package:flutter/material.dart';\nimport 'package:http_parser/http_parser.dart';\nimport 'package:image_picker/image_picker.dart';\nimport 'package:shared_preferences/shared_preferences.dart';\n\nimport '../../constants.dart';\n\nimport 'package:http/http.dart' as http;\nimport 'package:get/get.dart';\n\nimport 'package:mime/mime.dart';\n\nclass SaveTagServices {\n  static Future<void> saveTag(\n    int tblAssetMasterEncodeAssetCaptureID,\n    String majorCategory,\n    String majorCategoryDescription,\n    String minorCategory,\n    String minorCategoryDescription,\n    String tagNo,\n    String serialNo,\n    String assetDescription,\n    String assetType,\n    String assetCondition,\n    String country,\n    String region,\n    String cityName,\n    String dao,\n    String daoName,\n    String businessUnit,\n    String buildingNo,\n    String floorNo,\n    String employeeID,\n    String ponNumber,\n    String poDate,\n    String deliveryNoteNo,\n    String supplier,\n    String invoiceNo,\n    String invoiceDate,\n    String modelOfAsset,\n    String manufacturer,\n    String ownership,\n    String bought,\n    String terminalID,\n    String atmNumber,\n    String locationTag,\n    String buildingName,\n    String buildingAddress,\n    int mainSubSeriesNo,\n    String assetDateCaptured,\n    String assetTimeCaptured,\n    String assetDateScanned,\n    String assetTimeScanned,\n    int qty,\n    String phoneExtNo,\n    String fullLocationDetails,\n    List<XFile> file,\n  ) async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    String token = prefs.getString('token') ?? '';\n    String userLoginId = prefs.getString('userLoginId') ?? '';\n\n    final String url =\n        \"${Constant.baseUrl}/PostAssetMasterEncodeAssetCaptureFinal\";\n    final uri = Uri.parse(url);\n\n    final headers = <String, String>{\n      \"Authorization\": token,\n      \n    };\n\n    var request = http.MultipartRequest('POST', uri);\n\n    request.headers.addAll(headers);\n\n    request.fields['TblAssetMasterEncodeAssetCaptureID'] =\n        tblAssetMasterEncodeAssetCaptureID.toString();\n    request.fields['MajorCategory'] = majorCategory;\n    request.fields['MajorCategoryDescription'] = majorCategoryDescription;\n    request.fields['MInorCategory'] = minorCategory;\n    request.fields['MinorCategoryDescription'] = minorCategoryDescription;\n    request.fields['TagNumber'] = tagNo;\n    request.fields['sERIALnUMBER'] = serialNo;\n    request.fields['aSSETdESCRIPTION'] = assetDescription;\n    request.fields['assettYPE'] = assetType;\n    request.fields['aSSETcONDITION'] = assetCondition;\n    request.fields['cOUNTRY'] = country;\n    request.fields['rEGION'] = region;\n    request.fields['CityName'] = cityName;\n    request.fields['Dao'] = dao;\n    request.fields['DaoName'] = daoName;\n    request.fields['BusinessUnit'] = businessUnit;\n    request.fields['BUILDINGNO'] = buildingNo;\n    request.fields['FLOORNO'] = floorNo;\n    request.fields['EMPLOYEEID'] = employeeID;\n    request.fields['ponUmber'] = ponNumber;\n    request.fields['Podate'] = poDate;\n    request.fields['DeliveryNoteNo'] = deliveryNoteNo;\n    request.fields['Supplier'] = supplier;\n    request.fields['InvoiceNo'] = invoiceNo;\n    request.fields['InvoiceDate'] = invoiceDate;\n    request.fields['ModelofAsset'] = modelOfAsset;\n    request.fields['Manufacturer'] = manufacturer;\n    request.fields['Ownership'] = ownership;\n    request.fields['Bought'] = bought;\n    request.fields['TerminalID'] = terminalID;\n    request.fields['ATMNumber'] = atmNumber;\n    request.fields['LocationTag'] = locationTag;\n    request.fields['buildingName'] = buildingName;\n    request.fields['buildingAddress'] = buildingAddress;\n    request.fields['UserLoginID'] = userLoginId;\n    request.fields['MainSubSeriesNo'] = mainSubSeriesNo.toString();\n    request.fields['assetdatecaptured'] = assetDateCaptured;\n    request.fields['assetTimeCaptured'] = assetTimeCaptured;\n    request.fields['assetdatescanned'] = assetDateScanned;\n    request.fields['assettimeScanned'] = assetTimeScanned;\n    request.fields['QTY'] = qty.toString();\n    request.fields['PhoneExtNo'] = phoneExtNo;\n    request.fields['FullLocationDetails'] = fullLocationDetails;\n\n    // Helper function to get MIME type from file extension\n    MediaType? getMediaType(String path) {\n      final mimeType = lookupMimeType(path);\n      if (mimeType != null) {\n        final parts = mimeType.split('/');\n        if (parts.length == 2) {\n          return MediaType(parts[0], parts[1]);\n        }\n      }\n      return MediaType('application', 'octet-stream');\n    }\n\n// Assuming `file` is a list of files or objects containing file paths\n    List<File?> fle = [];\n\n// Convert file paths to File objects and add them to the list\n    for (int i = 0; i < file.length; i++) {\n      fle.add(File(file[i].path));\n    }\n\n// Add each file as a multipart file to the request\n    for (int i = 0; i < fle.length; i++) {\n      var multipart = await http.MultipartFile.fromPath(\n        'images',\n        fle[i]!.path,\n        filename: fle[i]!.path.split('/').last,\n        contentType: getMediaType(fle[i]!.path),\n      );\n      request.files.add(multipart);\n    }\n\n    // debugging outputs\n    print('Request URL: $url');\n    print('Headers: $headers');\n    print('Fields: ${request.fields}');\n    print('Files: ${request.files.map((file) => file.filename).toList()}');\n\n    try {\n      request.send().then(\n        (response) {\n          if (response.statusCode == 200 || response.statusCode == 201) {\n            print(response.statusCode);\n            DeleteTagServices.deleteTag(tagNo);\n\n            Get.offAll(const HomeScreen());\n            Get.snackbar(\n              \"Success\",\n              \"Tag Verified Successfully\",\n              backgroundColor: Colors.green,\n              colorText: Colors.white,\n              snackPosition: SnackPosition.BOTTOM,\n            );\n          } else {\n            print(response.statusCode);\n          }\n        },\n      );\n    } catch (e) {\n      print(e);\n      throw Exception('Failed to load Data');\n    }\n  }\n}\n"
        }
    ]
}